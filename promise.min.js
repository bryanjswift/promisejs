/*
 *  Copyright 2012 (c) Pierre Duquesne <stackp@online.fr>
 *  Licensed under the New BSD License.
 *  https://github.com/stackp/promisejs
 */(function(a){function b(a,b){return function(){return a.apply(b,arguments)}}function c(){this._callbacks=[]}function d(a){function h(a){return function(c,h){d+=1,f[a]=c,g[a]=h,d===b&&e.done(f,g)}}var b=a.length,d=0,e=new c,f=[],g=[];for(var i=0;i<b;i++)a[i]().then(h(i));return e}function e(a,b,d){var f=new c;return a.length===0?f.done(b,d):a[0](b,d).then(function(b,c){a.splice(0,1),e(a,b,c).then(function(a,b){f.done(a,b)})}),f}c.prototype.then=function(a,c){var d=b(a,c);this._isdone?d(this.error,this.result):this._callbacks.push(d)},c.prototype.done=function(a,b){this._isdone=!0,this.error=a,this.result=b;for(var c=0;c<this._callbacks.length;c++)this._callbacks[c](a,b);this._callbacks=[]};var f={Promise:c,join:d,chain:e};typeof define=="function"&&define.amd?define(function(){return f}):a.promise=f})(this);